# Telegram Health Bot

Telegram-бот для помощи в образе жизни, созданный для мужчины 69 лет. Бот использует модель **gpt-5.2** от OpenAI для обработки текстовых сообщений, изображений, голосовых сообщений и документов.

## Возможности

- ✅ Обработка текстовых сообщений
- ✅ Анализ изображений (через GPT-5.2 Vision)
- ✅ Обработка голосовых сообщений (транскрипция через Whisper + GPT-5.2)
- ✅ Чтение документов (PDF, DOCX, TXT)
- ✅ Сохранение истории диалогов в SQLite
- ✅ Контекстный диалог с учетом предыдущих сообщений

## Требования

- Python 3.8+
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))
- OpenAI API Key

## Установка

1. Клонируйте репозиторий или скачайте файлы проекта

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

4. Заполните `.env` файл своими токенами:
```
TELEGRAM_TOKEN=your_telegram_bot_token_here
OPENAI_API_KEY=your_openai_api_key_here
```

## Запуск

```bash
python bot.py
```

## Структура проекта

```
MedBot_matveevich/
├── bot.py                 # Основной файл бота
├── config.py              # Конфигурация (токены, модель gpt-5.2)
├── database.py            # Работа с SQLite
├── openai_client.py       # Клиент для OpenAI API (использует gpt-5.2)
├── dependencies.py        # Модуль для зависимостей
├── handlers/
│   ├── text_handler.py    # Обработка текстовых сообщений
│   ├── file_handler.py    # Обработка файлов (изображения, документы)
│   └── voice_handler.py   # Обработка голосовых сообщений
├── utils/
│   ├── file_utils.py      # Утилиты для работы с файлами
│   ├── document_utils.py  # Извлечение текста из документов
│   └── audio_utils.py     # Конвертация аудио для Whisper
├── requirements.txt       # Зависимости
├── .env.example          # Пример файла с переменными окружения
└── README.md             # Этот файл
```

## Важно

**Модель OpenAI**: Бот использует модель **gpt-5.2** во всех запросах к OpenAI API. Это указано в `config.py` как `OPENAI_MODEL = "gpt-5.2"`.

## Команды бота

- `/start` - Приветствие и начало работы
- `/reset` - Очистка истории диалога

## Системный промпт

Бот использует специальный системный промпт, который настроен на:
- Спокойное, уважительное общение
- Помощь в образе жизни (не медицинские советы)
- Простой, понятный язык без медицинских терминов
- Постепенные изменения привычек
- Фокус на самочувствии, энергии, сне

## База данных

Бот использует SQLite для хранения:
- Истории диалогов (таблица `conversations`)
- Данных пользователя (таблица `user_data`)

База данных создается автоматически при первом запуске в файле `bot.db`.

## Обработка файлов

### Изображения
- Поддерживаемые форматы: JPG, JPEG, PNG, GIF, WEBP
- Изображения отправляются в GPT-5.2 Vision API

### Документы
- Поддерживаемые форматы: PDF, DOCX, TXT
- Текст извлекается и отправляется в GPT-5.2

### Голосовые сообщения
- Голосовые сообщения транскрибируются через Whisper API
- Транскрипция отправляется в GPT-5.2 для обработки

## Логирование

Все события логируются в консоль с уровнем INFO. Формат логов:
```
2024-01-01 12:00:00 - bot - INFO - База данных инициализирована
```

## Устранение неполадок

### Ошибка "TELEGRAM_TOKEN не установлен"
- Убедитесь, что файл `.env` существует и содержит `TELEGRAM_TOKEN`

### Ошибка "OPENAI_API_KEY не установлен"
- Убедитесь, что файл `.env` содержит `OPENAI_API_KEY`

### Ошибка при обработке файлов
- Проверьте, что установлены все зависимости: `pip install -r requirements.txt`
- Для голосовых сообщений нужен ffmpeg: `brew install ffmpeg` (Mac) или `apt install ffmpeg` (Linux)

## Лицензия

Этот проект создан для личного использования.
